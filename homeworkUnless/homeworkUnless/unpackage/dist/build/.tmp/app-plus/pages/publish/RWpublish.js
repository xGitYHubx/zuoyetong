(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/publish/RWpublish"],{"0591":function(e,t,n){"use strict";n.r(t);var i=n("2b0c"),a=n("4a6f");for(var s in a)"default"!==s&&function(e){n.d(t,e,function(){return a[e]})}(s);n("51c2");var o=n("2877"),u=Object(o["a"])(a["default"],i["a"],i["b"],!1,null,null,null);t["default"]=u.exports},"2b0c":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement;e._self._c},a=[];n.d(t,"a",function(){return i}),n.d(t,"b",function(){return a})},"4a6f":function(e,t,n){"use strict";n.r(t);var i=n("6d9d"),a=n.n(i);for(var s in i)"default"!==s&&function(e){n.d(t,e,function(){return i[e]})}(s);t["default"]=a.a},"51c2":function(e,t,n){"use strict";var i=n("58bc"),a=n.n(i);a.a},"58bc":function(e,t,n){},"6d9d":function(e,t,n){"use strict";(function(e,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=u(n("a34a")),s=u(n("bfcb")),o=u(n("64d9"));function u(e){return e&&e.__esModule?e:{default:e}}function c(e,t,n,i,a,s,o){try{var u=e[s](o),c=u.value}catch(r){return void n(r)}u.done?t(c):Promise.resolve(c).then(i,a)}function r(e){return function(){var t=this,n=arguments;return new Promise(function(i,a){var s=e.apply(t,n);function o(e){c(s,i,a,o,u,"next",e)}function u(e){c(s,i,a,o,u,"throw",e)}o(void 0)})}}var l=function(){return n.e("components/uni-icon/uni-icon").then(n.bind(null,"4a2e"))},d=[["camera"],["album"],["camera","album"]],f={components:{uniIcon:l},data:function(){return{index_grade:0,index_subject:0,picker_subject:["语文","数学","英语","物理","化学","生物","政治","历史","地理"],picker_grade:["小学1年级","小学2年级","小学3年级","小学4年级","小学5年级","小学6年级","初中1年级","初中2年级","初中3年级","高中1年级","高中2年级","高中3年级"],imageList:[],index_img:0,modalName:null,price:0,sizeTypeIndex:1,sizeType:["压缩","原图","压缩或原图"],sourceTypeIndex:2,sourceType:["拍照","相册","拍照或相册"],textareaAValue:"",textContent:"",imgList:[],taskId:""}},onShow:function(){this.checkLogin(),s.default.getBalance()},methods:{textareaAInput:function(e){this.textareaAValue=e.detail.value},changePrice:function(e){this.price=e.detail.value},PickerChangeSubject:function(e){this.index_subject=e.detail.value},PickerChangeGrade:function(e){this.index_grade=e.detail.value},ChooseImage:function(){var t=this;e.chooseImage({count:9-this.imgList.length,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){0!=t.imgList.length?t.imgList=t.imgList.concat(e.tempFilePaths):t.imgList=e.tempFilePaths}})},ViewImage:function(t){e.previewImage({urls:this.imgList,current:t.currentTarget.dataset.url})},DelImg:function(t){var n=this;e.showModal({title:"召唤师",content:"确定要删除这段回忆吗？",cancelText:"再看看",confirmText:"再见",success:function(e){e.confirm&&n.imgList.splice(t.currentTarget.dataset.index,1)}})},checkLogin:function(){var t=e.getStorageSync("account");t&&"custom"==t&&e.showModal({title:"未登录",content:"发布题目需要登陆，点击确定前往登陆或注册",success:function(t){t.confirm?(console.log(i("用户点击确定"," at pages\\publish\\RWpublish.vue:166")),e.navigateTo({url:"../login/login"})):t.cancel&&e.navigateBack({delta:1})}})},publish:function(){var t=this;console.log(i("publush"," at pages\\publish\\RWpublish.vue:180"));var n={account:e.getStorageSync("account"),descText:this.textareaAValue,subject:this.index_subject,grade:this.index_grade,reward:this.price};console.log(i(n," at pages\\publish\\RWpublish.vue:188")),n.reward>e.getStorageSync("balance")?e.showModal({title:"金币不足",content:"剩余金币(".concat(e.getStorageSync("balance"),")不足以发布任务,点击确认前往充值"),success:function(t){t.confirm&&(console.log(i("用户点击确定"," at pages\\publish\\RWpublish.vue:195")),e.navigateTo({url:"../recharge/RWrechart/RWrechart"}))}}):e.request({url:this.$host+"/task/publish",header:{Authorization:e.getStorageSync("token")},method:"post",data:n,success:function(n){console.log(i(n," at pages\\publish\\RWpublish.vue:211")),1==n.data.success?(t.taskId=n.data.result,t.uploadImg()):e.showToast({title:"出错",icon:"none"})},fail:function(e){console.log(i(e," at pages\\publish\\RWpublish.vue:222"))}})},uploadImg:function(){var t=this,n=this.imgList;if(e.showLoading({title:"任务发布中..."}),0==this.imgList.length)e.hideLoading(),e.showToast({title:"任务发布成功",icon:"success",duration:1e3}),setTimeout(function(){e.navigateBack({delta:1})},1e3);else for(var i=function(i){e.getImageInfo({src:t.imgList[i],success:function(a){s=a.type,e.uploadFile({url:t.$host+"/upload/file",filePath:n[i],name:"file",formData:{fileName:"task/"+t.taskId+"/"+i,fileType:s},success:function(n){var a=JSON.parse(n.data);if(1==a.success){var s=a.result;e.request({url:t.$host+"/photo/upload",method:"post",data:[{linkId:t.taskId,position:i,url:s}],success:function(n){i==t.imgList.length-1&&(e.hideLoading(),e.showToast({title:"任务发布成功",icon:"success",duration:1e3}),setTimeout(function(){e.navigateBack({delta:1})},1e3))}})}},fail:function(t){e.showModal({content:t.errMsg,showCancel:!1})}})}})},a=0;a<this.imgList.length;a++){var s;i(a)}},checkPermission:function(){var t=r(a.default.mark(function t(n){var i,s;return a.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(i=n?n-1:this.sourceTypeIndex,!o.default.isIOS){t.next=7;break}return t.next=4,o.default.requestIOS(d[i][0]);case 4:t.t0=t.sent,t.next=10;break;case 7:return t.next=9,o.default.requestAndroid(0===i?"android.permission.CAMERA":"android.permission.READ_EXTERNAL_STORAGE");case 9:t.t0=t.sent;case 10:return s=t.t0,null===s||1===s?s=1:e.showModal({content:"没有开启权限",confirmText:"设置",success:function(e){e.confirm&&o.default.gotoAppSetting()}}),t.abrupt("return",s);case 13:case"end":return t.stop()}},t,this)}));function n(e){return t.apply(this,arguments)}return n}(),handleTextInput:function(e){this.textContent=e.detail.value},handleImageRmove:function(e){e>-1&&this.imageList.splice(e,1)}},onNavigationBarButtonTap:function(){}};t.default=f}).call(this,n("6e42")["default"],n("0de9")["default"])},d864:function(e,t,n){"use strict";(function(e){n("af20"),n("921b");i(n("66fd"));var t=i(n("0591"));function i(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("6e42")["createPage"])}},[["d864","common/runtime","common/vendor"]]]);