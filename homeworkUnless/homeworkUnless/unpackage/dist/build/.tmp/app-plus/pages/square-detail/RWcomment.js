(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/square-detail/RWcomment"],{"0ccc":function(t,e,n){},"12a0":function(t,e,n){"use strict";n.r(e);var a=n("71f3"),o=n("7c36");for(var i in o)"default"!==i&&function(t){n.d(e,t,function(){return o[t]})}(i);n("e2a6");var s=n("2877"),c=Object(s["a"])(o["default"],a["a"],a["b"],!1,null,null,null);e["default"]=c.exports},"71f3":function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement;t._self._c},o=[];n.d(e,"a",function(){return a}),n.d(e,"b",function(){return o})},"7c36":function(t,e,n){"use strict";n.r(e);var a=n("aa56"),o=n.n(a);for(var i in a)"default"!==i&&function(t){n.d(e,t,function(){return a[t]})}(i);e["default"]=o.a},aa56:function(t,e,n){"use strict";(function(t,n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a={data:function(){return{index:-1,imgList:[],modalName:null,textareaAValue:"",task:{},commentId:"",isCommented:0}},onLoad:function(t){this.task=JSON.parse(decodeURIComponent(t.task))},onShow:function(){this.checkLogin()},onBackPress:function(e){var a=this;return 0==this.isCommented?t.showModal({title:"提示",content:"评论尚未发布，确定退出吗？",success:function(e){e.confirm&&(console.log(n(a.task," at pages\\square-detail\\RWcomment.vue:63")),t.redirectTo({url:"./RWDetailById?taskId=".concat(a.task.taskId)}))}}):t.redirectTo({url:"./RWDetailById?taskId=".concat(a.task.taskId)}),!0},methods:{ChooseImage:function(){var e=this;t.chooseImage({count:4-this.imgList,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(t){0!=e.imgList.length?e.imgList=e.imgList.concat(t.tempFilePaths):e.imgList=t.tempFilePaths}})},checkLogin:function(){var e=t.getStorageSync("account");e&&"custom"==e&&t.showModal({title:"未登录",content:"发布评论需要登陆，点击确定前往登陆或注册",success:function(e){e.confirm?t.navigateTo({url:"../login/login"}):e.cancel&&t.navigateBack({delta:1})}})},sendCommen:function(){var e=this;t.showLoading({title:"评论中...",mask:!0}),t.request({url:this.$host+"/comment/publish",method:"post",header:{Authorization:t.getStorageSync("token")},data:{account:t.getStorageSync("account"),taskId:e.task.taskId,commentText:e.textareaAValue},success:function(a){1==a.data.success?(e.commentId=a.data.result,e.imgList.length>0?e.uploadImg():(t.hideLoading(),t.showToast({title:"评论发表成功",icon:"success",duration:500}),e.isCommented=1,setTimeout(function(){t.navigateBack({delta:1})},1e3))):(t.hideLoading(),console.log(n(a," at pages\\square-detail\\RWcomment.vue:154")),t.showToast({title:"发送失败",icon:"none"}))},fail:function(e){console.log(n(e," at pages\\square-detail\\RWcomment.vue:163")),t.hideLoading(),t.showToast({title:"发送失败",icon:"none"})}})},uploadImg:function(){var e=this,a=this.imgList;t.showLoading({title:"评论发表中..."});for(var o=0,i=function(i){t.getImageInfo({src:e.imgList[i],success:function(s){c=s.type,t.uploadFile({url:e.$host+"/upload/file",filePath:a[i],name:"file",formData:{fileName:"comment/"+e.commentId+"/"+i,fileType:c},success:function(a){console.log(n(a," at pages\\square-detail\\RWcomment.vue:194"));var s=JSON.parse(a.data);if(1==s.success){var c=s.result;t.request({url:e.$host+"/photo/upload",method:"post",data:JSON.stringify([{linkId:e.commentId,position:i,url:c}]),success:function(n){o++,o==e.imgList.length&&(t.hideLoading(),t.showToast({title:"评论发表成功",icon:"success",duration:500}),e.isCommented=1,setTimeout(function(){t.navigateBack({delta:1})},1e3))},fail:function(t){o++,console.log(n(t," at pages\\square-detail\\RWcomment.vue:227"))}})}},fail:function(e){console.log(n(e," at pages\\square-detail\\RWcomment.vue:234")),t.showModal({content:e.errMsg,showCancel:!1})}})}})},s=0;s<this.imgList.length;s++){var c;i(s)}},ViewImage:function(e){t.previewImage({urls:this.imgList,current:e.currentTarget.dataset.url})},DelImg:function(e){var n=this;t.showModal({title:"召唤师",content:"确定要删除这段回忆吗？",cancelText:"再看看",confirmText:"再见",success:function(t){t.confirm&&n.imgList.splice(e.currentTarget.dataset.index,1)}})},textareaAInput:function(t){this.textareaAValue=t.detail.value}}};e.default=a}).call(this,n("6e42")["default"],n("0de9")["default"])},bd2c:function(t,e,n){"use strict";(function(t){n("af20"),n("921b");a(n("66fd"));var e=a(n("12a0"));function a(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("6e42")["createPage"])},e2a6:function(t,e,n){"use strict";var a=n("0ccc"),o=n.n(a);o.a}},[["bd2c","common/runtime","common/vendor"]]]);